<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
		     xmlns:context="http://www.springframework.org/schema/context"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:security="http://www.springframework.org/schema/security"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
                                 http://www.springframework.org/schema/beans/spring-beans.xsd
                                 http://www.springframework.org/schema/security
                                 http://www.springframework.org/schema/security/spring-security.xsd
                                 http://www.springframework.org/schema/context
			 					 http://www.springframework.org/schema/context/spring-context.xsd">

<context:component-scan base-package="kr.co.korea.dao" />

        <security:http auto-config="true" use-expressions="true">
			<security:intercept-url pattern="/members/" access="hasRole('ROLE_ADMIN')" />
			<security:intercept-url pattern="/" access="hasAnyRole('ROLE_ADMIN','ROLE_MEMBER')" />
			
			<security:form-login
        		username-parameter="mid"
       			password-parameter="mpw"
        		login-processing-url="/user/login_pro"
       			login-page="/user/login"
        		authentication-success-handler-ref="loginSuccessHandler"
        		authentication-failure-handler-ref="loginFailureHandler"
		    />
			
			<security:logout
    	    logout-url="/user/logout"
        	logout-success-url="/"
	   		 />
      	</security:http>
        
        <security:authentication-manager>
        	<security:authentication-provider ref="userAuthProvider"/>
            <security:authentication-provider user-service-ref="userSerivce">
            </security:authentication-provider>
        </security:authentication-manager>


<bean id="sqltemp" class="org.mybatis.spring.SqlSessionTemplate">
		<constructor-arg index="0" ref="sqlSession"></constructor-arg>
</bean>        
        

<bean id="userAuthProvider" class="kr.co.korea.service.SecrurityMemberAuthenticationProvider"/>        

<bean id="userSerivce" class="kr.co.korea.service.SecurityMemberServiceDetails"/>

<bean id="loginSuccessHandler" class="kr.co.korea.handler.LoginSuccessHandler">
    <property name="mid" value="mid"/>
    <property name="defaulturl" value="/user/login_pro"/>
</bean>

<bean id="loginFailureHandler" class="kr.co.korea.handler.LoginFailHandler">
    <property name="mid" value="mid"/>
    <property name="mpw" value="mpw"/>
    <property name="defaulturl" value="/user/login?error"/>
</bean>
  
<bean id="bcryptPasswordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"/>      

</beans>